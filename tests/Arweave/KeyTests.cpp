// Copyright Â© 2017-2022 Trust Wallet.
//
// This file is part of Trust. The full Trust copyright notice, including
// terms governing use, modification, and redistribution, is contained in the
// file LICENSE at the root of the source code distribution tree.

#include "Arweave/Key.h"
#include <TrustWalletCore/TWCoinType.h>
#include "HDWallet.h"
#include "HexCoding.h"

#include <gtest/gtest.h>

using namespace TW::Arweave;
using namespace TW;

const auto Seed = "7d1fda7b2223009190fe30c9701ecf89feb0c775a2e4e3fcc19435e316c672075f807160ca538e8e0a62fd937c062d0ad5c02ab1e8a3b60fe70ab65cfd991576"; // 125  31 218 ...
//const auto Key1 = "f5e1bb6bc4b9e265ce1dbd98ba928529f1426bbf4cb5dca03c5fcc23f5136842b985ff0f2dc9d7aa8152bfea346c11476212a6355073558dc51891edd5d9f9a23ef1035182c91f1b8cb1fd40663e27e78a8b3bf24a687fd50034afb164b430595f58b6da27164f4619786493e56ac1be42178b31317dbb0f42f8af325f0a0802906a449d1a63db8348fa1dc0aee3d4a22dcb5d841fe54ca969eea70abbca373889b5ccc98ce8d6fbbb3860a74c8363230718b7066575cc4b0e407025dddfe6a06bb7c70b1151588b32b4ff8a9e5228f050a402cf44688f4976d6a035223252a39f89a56711dcedc03baed24a6b09b6e540b766c5bc1c6188b57048cd3b92fa5546"; // 245 225 187 ...

TEST(ArweaveKey, generateKeyFromPrngSeed) {
    {
        const auto seed = parse_hex(Seed);   
        const auto key = keyGenerateFromPrngSeed(seed);
        EXPECT_EQ(hex(key.bytes), "f5e1bb6bc4b9e265ce1dbd98ba928529f1426bbf4cb5dca03c5fcc23f5136842b985ff0f2dc9d7aa8152bfea346c11476212a6355073558dc51891edd5d9f9a23ef1035182c91f1b8cb1fd40663e27e78a8b3bf24a687fd50034afb164b430595f58b6da27164f4619786493e56ac1be42178b31317dbb0f42f8af325f0a0802906a449d1a63db8348fa1dc0aee3d4a22dcb5d841fe54ca969eea70abbca373889b5ccc98ce8d6fbbb3860a74c8363230718b7066575cc4b0e407025dddfe6a06bb7c70b1151588b32b4ff8a9e5228f050a402cf44688f4976d6a035223252a39f89a56711dcedc03baed24a6b09b6e540b766c5bc1c6188b57048cd3b92fa55465c1b69f119c19214b86479df3475e543dd0e5b958668d166f9e325bdd7319bf0554f7d8531b01dc7c468f40b96988bdc53cd8e72fa4ede6de3f0c0b79f6c4acf0b837a96a11644677019b86eb400c60e9dc61dfd622aacc613bddaa199b019b5521878e864ff97d532bb344d3e3eb0f67851fe762e615e45c8740063e8b245e7367a2d06a361d5c0c6f877e2a2a9a35f629979e026b166f977496b37b51aeab0e8656437e2383c902268f8a157eb3a2033587c792894fc3212db493a8ea5e6ef0c316f2038ee4a29bba8829876ff4479eeceb01c4b639769a3d8233d7cf5c5f4ca24a2ba22a101dabfc07a7f303b16e1005cf6bda5296beebbffd7866d44ed");
    }
}

TEST(ArweaveKey, deriveKeyFromMnemonic) {
    // test data from arweave-mnemonic-keys
    const auto mnemonic = "dust mushroom rigid hip know prefer siren dust message number double door";
    const auto wallet = HDWallet(mnemonic, "", true);
    const auto key = wallet.getKey(TWCoinTypeArweave, TWDerivationDefault);
    EXPECT_EQ(hex(key.bytes), "f5e1bb6bc4b9e265ce1dbd98ba928529f1426bbf4cb5dca03c5fcc23f5136842b985ff0f2dc9d7aa8152bfea346c11476212a6355073558dc51891edd5d9f9a23ef1035182c91f1b8cb1fd40663e27e78a8b3bf24a687fd50034afb164b430595f58b6da27164f4619786493e56ac1be42178b31317dbb0f42f8af325f0a0802906a449d1a63db8348fa1dc0aee3d4a22dcb5d841fe54ca969eea70abbca373889b5ccc98ce8d6fbbb3860a74c8363230718b7066575cc4b0e407025dddfe6a06bb7c70b1151588b32b4ff8a9e5228f050a402cf44688f4976d6a035223252a39f89a56711dcedc03baed24a6b09b6e540b766c5bc1c6188b57048cd3b92fa55465c1b69f119c19214b86479df3475e543dd0e5b958668d166f9e325bdd7319bf0554f7d8531b01dc7c468f40b96988bdc53cd8e72fa4ede6de3f0c0b79f6c4acf0b837a96a11644677019b86eb400c60e9dc61dfd622aacc613bddaa199b019b5521878e864ff97d532bb344d3e3eb0f67851fe762e615e45c8740063e8b245e7367a2d06a361d5c0c6f877e2a2a9a35f629979e026b166f977496b37b51aeab0e8656437e2383c902268f8a157eb3a2033587c792894fc3212db493a8ea5e6ef0c316f2038ee4a29bba8829876ff4479eeceb01c4b639769a3d8233d7cf5c5f4ca24a2ba22a101dabfc07a7f303b16e1005cf6bda5296beebbffd7866d44ed");
}
